<!DOCTYPE html>

<p>Input RPC here. Input what you want, leave everything else blank.</p>
<form id="rpcForm">
    <label for="details">RPC title:</label>
    <input type="text" id="details" name="title" />
    <br />
    <label for="state">RPC description:</label>
    <input type="text" id="state" name="description" />
    <br />
    <label for="largeImageKey">Large image key:</label>
    <input type="text" id="largeImageKey" name="Large image key" />
    <br />
    <label for="largeImageText">Large image hover text:</label>
    <input type="text" id="largeImageText" name="Large image text" />
    <br />
    <label for="smallImageKey">Small image key:</label>
    <input type="text" id="smallImageKey" name="Small image key" />
    <br />
    <label for="smallImageText">Small image hover text:</label>
    <input type="text" id="smallImageText" name="Small image text" />
    <br />
    <input type="submit" />
    <input type="reset" />
    <div id="reply"></div>
</form>
<script>
    const { ipcRenderer, ipcMain } = require('electron');

    const form = document.querySelector('#rpcForm');
    form.addEventListener('submit', submitForm);
    form.addEventListener('reset', resetForm);

    function submitForm(e) {
        e.preventDefault();

        let newPresence = {};

        let children = form.querySelectorAll('input[type="text"]');

        children.forEach((child) => {
            if (child.value !== '') {
                newPresence[child.id] = child.value;
            }
        });

        ipcRenderer.send('doUpdatePresence', newPresence);
    }

    ipcRenderer.on('asynchronous-reply', (event, arg) => {
        let reply = document.querySelector('#reply');

        reply.innerHTML =
            'RPC successfully set! It may take some time for the changes to appear...';

        setTimeout(() => {
            reply.innerHTML = '';
        }, 4e3);
    });

    function resetForm(e) {
        e.preventDefault();

        ipcRenderer.send('destroyRpc');

        ipcRenderer.on('asynchronous-reply', (event, arg) => {
            let reply = document.querySelector('#reply');

            if (arg.success === true) {
                reply.innerHTML =
                    'Sucessfully reset the client! Redirecting to the client ID page...';
            } else {
                replyDiv.innerHTML = `There was an error! Please manually restart the app: ${arg.error}`;
            }
        });
    }
</script>
